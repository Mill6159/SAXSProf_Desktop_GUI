# SAXProf
This is a stripped-down SAXSProf example that was used to create the web version of SAXSProf and has been repurposed for a desktop GUI and more advanced error calculations for SAXS curves at high pressure.

## Running
1. install a python environment that contains matplotlib etc. I use Enthought's academic distribution, but others should work.
2. I run this from within ipython, but direct python should be ok.
    * `$ipython -pylab`
	* `In[1]: run SAXSProf.py`
3. a single plot window should appear showing smooth lysozyme curve and simulated noise

**WARNING:** this code badly needs a re-write using more sophisticated object hierarchy that will help keep q-vectors together with "matched" I vectors. By "matched", I mean with the same number of q-points as correctly corresponding I points. As you will see from the SAXS object in the SAXS8.py file, there can be multiple q-vectors due to experimental input, whether an input curve is background subtracted or not, whether it was generated by the detector mask, goes to q=0, or something else. So keeping all these types straight and interpolating them is a bookkeeping challenge which better code design could help. This started as a student project and I didn't anticipate that issue. 

Also, be careful with looping this code while changing parameters. Some paramters, such as energy, require that you re-generate the base q-vector via the mask procedure ... and there is no error-checking to make sure you do this. So, the execution model for the code also needs some work to assure that when you change a parameter, all other dependent parameters get properly changed ... in an efficient way. I've done that, mostly ... just be careful when looping over energy.

The code mask model is simplistic, but works surprisingly well. At one point, the code had the ability to load masks from RAW, but that broke. But before it broke, I did comparisons and found that a simple mask is really pretty good.

## How The Code Works
You basically create a "SAXS" object and use the methods to generate the simulated profiles. SAXS8.py contains the class and all the implementation details.

1. First you define the detector and mask. This determines the q-space points that will be used by everything else (energy-dependent!)
2. load the computed smooth scattering profile from FoXS or some other program. 
3. load the "standard profiles" describing buffer, windows, and slit scatter "vacuum".
4. generate the buffer model (simulate_buf)
5. calculate the smooth model curve on the buffer model q points
6. calculate sigmas and put noise on the smooth curve
7. plot

  I've already generated standard profiles for the lysozyme example, but you may want to generate
  "standard profiles" for buffer, window, and "vacuum" for your own systems as in the paper.
  At the beginning of the example code, I have listed the experimental data files
  I used to generate these standard profiles: buffer_model, vac_model, win_model.
  You must specify the flux and exposure (and window types) at which these data were collected.
  By uncommenting these lines, you can generate your own standard profiles:

```python
#saxs1.load_buf(buffer_model, t=buffer_exposure, P=buffer_flux, interpolate=True, q_array = saxs1.default_q)
#saxs1.load_vac(vac_model, t=vac_exposure, P=vac_flux, interpolate=True, q_array = saxs1.default_q)
#saxs1.load_win(win_model, t=win_exposure, P=win_flux, interpolate=True, q_array = saxs1.default_q)
#saxs1.writeStandardProfiles("Nov07_")
```

Good luck. 

Richard

## Additional notes for RM/REG spring2020 updates:

We generated a new class (SAXProf_ErrCalcs.py) that utilizes the inheritance property of Python. (i.e. it imports from the other modules to do its calculations).
This class calculates the error in Rg as determined by the Guiner fit as is outlined in the *_Formula.pdf file within this repository.
This allows for comparison of the Rg error from an analytical model (i.e. we know where the error comes from) and the error produced by many fitting routines
such as RAW or primus.
Furthermore, this allowed for us to model the error in Rg as a function of concentration and pressure (contrast), which is also outlined in the *_Formula.pdf file.

## Running Desktop GUI

Ensure you have Python3 installed locally as well as the following Python modules:  
(1) Matplotlib  
(2) tkinter  
(3) numpy  
(4) scipy  
